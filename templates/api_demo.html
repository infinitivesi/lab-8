{% extends "base.html" %}

{% block title %}API –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-100 to-red-100 py-8">
    <div class="container mx-auto px-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è API</h1>
            <p class="text-lg text-gray-600">–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤ –≤–∞—à–æ–≥–æ API</p>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="bg-white rounded-lg shadow-xl overflow-hidden">
            <!-- –í–∫–ª–∞–¥–∫–∏ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó -->
            <div class="flex flex-wrap border-b bg-gray-50">
                <button class="tab-btn flex-1 py-4 px-6 text-center font-semibold hover:bg-gray-100 transition active-tab bg-purple-500 text-white" data-tab="products">
                    üì¶ –ü—Ä–æ–¥—É–∫—Ç–∏
                </button>
                <button class="tab-btn flex-1 py-4 px-6 text-center font-semibold hover:bg-gray-100 transition" data-tab="orders">
                    üìã –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è
                </button>
                <button class="tab-btn flex-1 py-4 px-6 text-center font-semibold hover:bg-gray-100 transition" data-tab="feedback">
                    üí¨ –í—ñ–¥–≥—É–∫–∏
                </button>
            </div>

            <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —Å—Ç–∞–Ω -->
            <div id="message" class="hidden fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg z-50 animate-fade-in max-w-md">
                <span id="messageText"></span>
            </div>

            <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
            <div id="loading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40">
                <div class="bg-white rounded-lg p-8 text-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto"></div>
                    <p class="mt-4 text-gray-700 font-semibold">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
                </div>
            </div>

            <!-- ===== –í–ö–õ–ê–î–ö–ê: –ü–†–û–î–£–ö–¢–ò ===== -->
            <div id="products-tab" class="tab-content p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üì¶ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ü—Ä–æ–¥—É–∫—Ç–∞–º–∏</h2>

                <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É -->
                <div class="bg-gradient-to-r from-purple-50 to-red-50 rounded-lg p-6 mb-8 border-l-4 border-purple-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–æ–¥—É–∫—Ç</h3>
                    <form id="productForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">–ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É *</label>
                                <input type="text" id="productName" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: –ù–æ—É—Ç–±—É–∫" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">–¶—ñ–Ω–∞ (–≥—Ä–Ω) *</label>
                                <input type="number" id="productPrice" placeholder="1999.99" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</label>
                                <input type="text" id="productImage" placeholder="https://example.com/image.jpg" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-red-500 text-white font-bold py-3 rounded-lg hover:shadow-lg transition duration-300">
                            ‚úÖ –î–æ–¥–∞—Ç–∏ –ü—Ä–æ–¥—É–∫—Ç
                        </button>
                    </form>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ -->
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤</h3>
                    <button onclick="loadProducts()" class="mb-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                        üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫
                    </button>
                    <div id="productsList" class="space-y-4">
                        <div class="text-center text-gray-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤...</div>
                    </div>
                </div>
            </div>

            <!-- ===== –í–ö–õ–ê–î–ö–ê: –ó–ê–ú–û–í–õ–ï–ù–ù–Ø ===== -->
            <div id="orders-tab" class="tab-content hidden p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìã –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏</h2>

                <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
                <div class="bg-gradient-to-r from-purple-50 to-red-50 rounded-lg p-6 mb-8 border-l-4 border-purple-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>
                    <form id="orderForm" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Email *</label>
                                <input type="email" id="orderEmail" placeholder="user@example.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                                <input type="tel" id="orderPhone" placeholder="+38 (0XX) XXX-XX-XX" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
                                <input type="text" id="orderAddress" placeholder="–≤—É–ª. –®–µ–≤—á–µ–Ω–∫–∞, 1, –º. –ö–∏—ó–≤" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-red-500 text-white font-bold py-3 rounded-lg hover:shadow-lg transition duration-300">
                            ‚úÖ –°—Ç–≤–æ—Ä–∏—Ç–∏ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è
                        </button>
                    </form>
                </div>

                <!-- –ü–æ—à—É–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å –∑–∞ email -->
                <div class="bg-blue-50 rounded-lg p-6 mb-8 border-l-4 border-blue-500">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">–ü–æ—à—É–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å –∑–∞ email</h3>
                    <div class="flex gap-2">
                        <input type="email" id="searchEmail" placeholder="user@example.com" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button onclick="searchOrdersByEmail()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition font-semibold">
                            üîç –ü–æ—à—É–∫
                        </button>
                    </div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å -->
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–°–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å</h3>
                    <button onclick="loadOrders()" class="mb-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                        üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫
                    </button>
                    <div id="ordersList" class="space-y-4">
                        <div class="text-center text-gray-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å...</div>
                    </div>
                </div>
            </div>

            <!-- ===== –í–ö–õ–ê–î–ö–ê: –í–Ü–î–ì–£–ö–ò ===== -->
            <div id="feedback-tab" class="tab-content hidden p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üí¨ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –í—ñ–¥–≥—É–∫–∞–º–∏</h2>

                <!-- –§–æ—Ä–º–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É -->
                <div class="bg-gradient-to-r from-purple-50 to-red-50 rounded-lg p-6 mb-8 border-l-4 border-purple-500">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–ó–∞–ª–∏—à–∏—Ç–∏ –≤—ñ–¥–≥—É–∫</h3>
                    <form id="feedbackForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">–Ü–º'—è *</label>
                            <input type="text" id="feedbackName" placeholder="–í–∞—à–µ —ñ–º'—è" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Email *</label>
                            <input type="email" id="feedbackEmail" placeholder="your@email.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è *</label>
                            <textarea id="feedbackMessage" placeholder="–í–∞—à –≤—ñ–¥–≥—É–∫..." rows="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" required></textarea>
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-red-500 text-white font-bold py-3 rounded-lg hover:shadow-lg transition duration-300">
                            ‚úÖ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –í—ñ–¥–≥—É–∫
                        </button>
                    </form>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –≤—ñ–¥–≥—É–∫—ñ–≤ -->
                <div>
                    <h3 class="text-xl font-bold text-gray-800 mb-4">–í—Å—ñ –≤—ñ–¥–≥—É–∫–∏</h3>
                    <button onclick="loadFeedback()" class="mb-4 bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition">
                        üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫
                    </button>
                    <div id="feedbackList" class="space-y-4">
                        <div class="text-center text-gray-500">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—ñ–≤...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .tab-btn {
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .tab-btn.active-tab {
        background-color: #a855f7;
        color: white;
        border-b: 3px solid #7c3aed;
    }

    .tab-content {
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .item {
        background: linear-gradient(135deg, #f3e7e9 0%, #f5f7fa 100%);
        border-radius: 0.5rem;
        padding: 1.5rem;
        border-left: 4px solid #a855f7;
        transition: all 0.3s ease;
    }

    .item:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .empty-state {
        text-align: center;
        padding: 3rem;
        color: #9ca3af;
        font-size: 1.125rem;
    }

    #message {
        transition: all 0.3s ease;
    }

    #message.success {
        background-color: #10b981;
        color: white;
    }

    #message.error {
        background-color: #ef4444;
        color: white;
    }

    #message.info {
        background-color: #3b82f6;
        color: white;
    }

    #message.show {
        display: block;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .animate-spin {
        animation: spin 1s linear infinite;
    }
</style>

<script>
    // ============================================
    // –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø - API ENDPOINTS
    // ============================================

    const API_ENDPOINTS = {
        products: 'http://localhost:5000/api/v1/products',
        orders: 'http://localhost:5000/api/v1/orders',
        ordersByEmail: 'http://localhost:5000/api/v1/orders/search',
        feedback: 'http://localhost:5000/api/v1/feedback'
    };

    // ============================================
    // –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á
    // ============================================

    function showLoading(show) {
        const loading = document.getElementById('loading');
        loading.style.display = show ? 'flex' : 'none';
    }

    function showMessage(text, type = 'info') {
        const messageBox = document.getElementById('message');
        const messageText = document.getElementById('messageText');
        
        messageText.textContent = text;
        messageBox.className = type + ' show';
        messageBox.style.display = 'block';
        
        setTimeout(() => {
            messageBox.style.display = 'none';
            messageBox.className = '';
        }, 5000);
    }

    // ============================================
    // –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –í–ö–õ–ê–î–ö–ê–ú–ò
    // ============================================

    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.getAttribute('data-tab');

            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –≤—Å—ñ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // –í–∏–¥–∞–ª—è—î–º–æ –∞–∫—Ç–∏–≤–Ω–∏–π –∫–ª–∞—Å –∑ —É—Å—ñ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('active-tab');
                b.style.backgroundColor = '';
                b.style.color = '';
            });

            // –ê–∫—Ç–∏–≤—É—î–º–æ –≤–∏–±—Ä–∞–Ω—É –≤–∫–ª–∞–¥–∫—É
            const activeTab = document.getElementById(tabName + '-tab');
            if (activeTab) {
                activeTab.classList.remove('hidden');
            }

            btn.classList.add('active-tab');
            btn.style.backgroundColor = '#a855f7';
            btn.style.color = 'white';

            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –¥–∞–Ω—ñ –ø—Ä–∏ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—ñ –≤–∫–ª–∞–¥–∫–∏
            if (tabName === 'products') {
                loadProducts();
            } else if (tabName === 'orders') {
                loadOrders();
            } else if (tabName === 'feedback') {
                loadFeedback();
            }
        });
    });

    // ============================================
    // –†–û–ë–û–¢–ê –ó –ü–†–û–î–£–ö–¢–ê–ú–ò
    // ============================================

    async function loadProducts() {
        try {
            showLoading(true);
            const response = await fetch(API_ENDPOINTS.products);

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            const data = await response.json();
            displayProducts(data.data || data.products || data);

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—ñ–≤: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    }

    function displayProducts(items) {
        const container = document.getElementById('productsList');
        container.innerHTML = '';

        if (!items || items.length === 0) {
            container.innerHTML = `<div class="empty-state">üì≠ –ü—Ä–æ–¥—É–∫—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π –ø—Ä–æ–¥—É–∫—Ç!</div>`;
            return;
        }

        items.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';

            const imageHtml = item.image ? `<img src="${item.image}" alt="${item.name}" class="h-24 w-24 object-cover rounded mb-2">` : '';

            itemDiv.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        ${imageHtml}
                        <h4 class="text-lg font-bold text-gray-800">${item.name || '–ë–µ–∑ –Ω–∞–∑–≤–∏'}</h4>
                        <p class="text-purple-600 font-bold text-lg mt-2">üí∞ ${item.price || 0} –≥—Ä–Ω</p>
                    </div>
                    <button onclick="deleteProduct(${item.id})" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
                        üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
                    </button>
                </div>
            `;

            container.appendChild(itemDiv);
        });
    }

    document.getElementById('productForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const name = document.getElementById('productName').value.trim();
        const price = parseFloat(document.getElementById('productPrice').value);
        const image = document.getElementById('productImage').value.trim();

        if (!name || name.length < 2) {
            showMessage('‚ùå –ù–∞–∑–≤–∞ –ø—Ä–æ–¥—É–∫—Ç—É –ø–æ–≤–∏–Ω–Ω–∞ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏', 'error');
            return;
        }

        if (!price || price <= 0) {
            showMessage('‚ùå –¶—ñ–Ω–∞ –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –±—ñ–ª—å—à–æ—é –∑–∞ 0', 'error');
            return;
        }

        try {
            showLoading(true);

            const response = await fetch(API_ENDPOINTS.products, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, price, image })
            });

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            showMessage('‚úÖ –ü—Ä–æ–¥—É–∫—Ç —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!', 'success');
            await loadProducts();
            event.target.reset();

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    });

    async function deleteProduct(productId) {
        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –ø—Ä–æ–¥—É–∫—Ç?')) {
            return;
        }

        try {
            showLoading(true);

            const response = await fetch(`${API_ENDPOINTS.products}/${productId}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            showMessage('‚úÖ –ü—Ä–æ–¥—É–∫—Ç —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
            await loadProducts();

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç—É: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    }

    // ============================================
    // –†–û–ë–û–¢–ê –ó –ó–ê–ú–û–í–õ–ï–ù–ù–Ø–ú–ò
    // ============================================

    async function loadOrders() {
        try {
            showLoading(true);
            const response = await fetch(API_ENDPOINTS.orders);

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            const data = await response.json();
            displayOrders(data.data || data.orders || data);

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω—å: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    }

    function displayOrders(items) {
        const container = document.getElementById('ordersList');
        container.innerHTML = '';

        if (!items || items.length === 0) {
            container.innerHTML = `<div class="empty-state">üì≠ –ó–∞–º–æ–≤–ª–µ–Ω—å –ø–æ–∫–∏ –Ω–µ–º–∞—î. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!</div>`;
            return;
        }

        items.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';

            const statusColor = item.status === 'completed' ? 'green' : 'yellow';

            itemDiv.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h4 class="text-lg font-bold text-gray-800">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è #${item.id}</h4>
                        <p class="text-gray-600 mt-2"><strong>Email:</strong> ${item.email || 'N/A'}</p>
                        <p class="text-gray-600"><strong>–ê–¥—Ä–µ—Å–∞:</strong> ${item.address || 'N/A'}</p>
                        <p class="text-gray-600"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${item.phone || 'N/A'}</p>
                        <p class="text-gray-600"><strong>–°—É–º–∞:</strong> ${item.total_price || 0} –≥—Ä–Ω</p>
                        <p class="text-${statusColor}-600 font-bold mt-2"><strong>–°—Ç–∞—Ç—É—Å:</strong> ${item.status || 'pending'}</p>
                    </div>
                    <button onclick="deleteOrder(${item.id})" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
                        üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
                    </button>
                </div>
            `;

            container.appendChild(itemDiv);
        });
    }

    async function searchOrdersByEmail() {
        const email = document.getElementById('searchEmail').value.trim();

        if (!email) {
            showMessage('‚ùå –í–≤–µ–¥—ñ—Ç—å email –¥–ª—è –ø–æ—à—É–∫—É', 'error');
            return;
        }

        try {
            showLoading(true);
            const response = await fetch(`${API_ENDPOINTS.ordersByEmail}?email=${encodeURIComponent(email)}`);

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            const data = await response.json();
            const orders = data.data || data.orders || data;
            displayOrders(orders);
            showMessage(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ ${orders.length} –∑–∞–º–æ–≤–ª–µ–Ω—å`, 'success');

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    }

    document.getElementById('orderForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const email = document.getElementById('orderEmail').value.trim();
        const phone = document.getElementById('orderPhone').value.trim();
        const address = document.getElementById('orderAddress').value.trim();

        if (!email || !phone || !address) {
            showMessage('‚ùå –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è', 'error');
            return;
        }

        try {
            showLoading(true);

            const response = await fetch(API_ENDPOINTS.orders, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email, phone, address, cart: {} })
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑ —Å–µ—Ä–≤–µ—Ä–∞:', errorData);
                throw new Error(errorData.error || `HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            showMessage('‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ!', 'success');
            await loadOrders();
            event.target.reset();

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    });

    async function deleteOrder(orderId) {
        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?')) {
            return;
        }

        try {
            showLoading(true);

            const response = await fetch(`${API_ENDPOINTS.orders}/${orderId}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            showMessage('‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
            await loadOrders();

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    }

    // ============================================
    // –†–û–ë–û–¢–ê –ó –í–Ü–î–ì–£–ö–ê–ú–ò
    // ============================================

    async function loadFeedback() {
        try {
            showLoading(true);
            const response = await fetch(API_ENDPOINTS.feedback);

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            const data = await response.json();
            displayFeedback(data.data || data.feedback || data);

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—ñ–≤: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    }

    function displayFeedback(items) {
        const container = document.getElementById('feedbackList');
        container.innerHTML = '';

        if (!items || items.length === 0) {
            container.innerHTML = `<div class="empty-state">üì≠ –í—ñ–¥–≥—É–∫—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î. –ó–∞–ª–∏—à—Ç–µ –ø–µ—Ä—à–∏–π –≤—ñ–¥–≥—É–∫!</div>`;
            return;
        }

        items.forEach(item => {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item';

            itemDiv.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h4 class="text-lg font-bold text-gray-800">${item.name || '–ê–Ω–æ–Ω—ñ–º'}</h4>
                        <p class="text-gray-600 text-sm mt-1">üìß ${item.email || 'N/A'}</p>
                        <p class="text-gray-700 mt-3">"${item.message || '–ù–µ–º–∞—î —Ç–µ–∫—Å—Ç—É–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è'}"</p>
                    </div>
                    <button onclick="deleteFeedback(${item.id})" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">
                        üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏
                    </button>
                </div>
            `;

            container.appendChild(itemDiv);
        });
    }

    document.getElementById('feedbackForm').addEventListener('submit', async (event) => {
        event.preventDefault();

        const name = document.getElementById('feedbackName').value.trim();
        const email = document.getElementById('feedbackEmail').value.trim();
        const message = document.getElementById('feedbackMessage').value.trim();

        if (!name || name.length < 2) {
            showMessage('‚ùå –Ü–º\'—è –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 2 —Å–∏–º–≤–æ–ª–∏', 'error');
            return;
        }

        if (!email) {
            showMessage('‚ùå Email –æ–±–æ–≤\'—è–∑–∫–æ–≤–∏–π', 'error');
            return;
        }

        if (!message || message.length < 5) {
            showMessage('‚ùå –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω–æ –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 5 —Å–∏–º–≤–æ–ª—ñ–≤', 'error');
            return;
        }

        try {
            showLoading(true);

            const response = await fetch(API_ENDPOINTS.feedback, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email, message })
            });

            if (!response.ok) {
                const errorData = await response.json();
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑ —Å–µ—Ä–≤–µ—Ä–∞:', errorData);
                throw new Error(errorData.error || `HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            showMessage('‚úÖ –í—ñ–¥–≥—É–∫ —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!', 'success');
            await loadFeedback();
            event.target.reset();

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –Ω–∞–¥—ñ—Å–ª–∞–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    });

    async function deleteFeedback(feedbackId) {
        if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –≤—ñ–¥–≥—É–∫?')) {
            return;
        }

        try {
            showLoading(true);

            const response = await fetch(`${API_ENDPOINTS.feedback}/${feedbackId}`, {
                method: 'DELETE'
            });

            if (!response.ok) {
                throw new Error(`HTTP –ø–æ–º–∏–ª–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
            }

            showMessage('‚úÖ –í—ñ–¥–≥—É–∫ —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–æ!', 'success');
            await loadFeedback();

        } catch (error) {
            showMessage('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—ñ–¥–≥—É–∫—É: ' + error.message, 'error');
            console.error('–ü–æ–º–∏–ª–∫–∞:', error);
        } finally {
            showLoading(false);
        }
    }

    // ============================================
    // –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
    // ============================================

    window.addEventListener('load', () => {
        loadProducts();
    });
</script>
{% endblock %}
